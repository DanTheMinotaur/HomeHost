---
- name: Setup Docker Things
  gather_facts: true
  hosts: unicorn
  vars_files:
    - data/docker_apps.yml
    - data/configs.yml
  tasks:
    - name: Create Traefik Network
      shell: docker network create traefik-proxy || true
    - include_tasks: ansible/tasks/docker-compose-deploy.yml
      loop: "{{ lookup('dict', docker_apps, wantlist=True) }}"
      vars:
        app_name: "{{ item.key }}"
        compose_file: "{{ item.value.compose_file }}"
        files: "{{ item.value.files | default([]) }}"
